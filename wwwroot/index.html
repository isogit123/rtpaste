<html>

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
</head>

<body>
  <form id="form" class="">
    <textarea class="form-control" placeholder="Enter text" type="text" id="txt" name="txt"></textarea>
    <input type="submit" value="Send" class="btn btn-primary" />
  </form>
  <div id="list"></div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    msg = ""
    ev = ""
    if (location.href.includes('?')) {
      var queryStr = location.href.split('?')[1]
      var param = queryStr.split('=')
      if (param.length > 1) {
        var eIndex = param.indexOf("e") + 1
        if (eIndex != 0)
          ev = param[eIndex]
      }
      var msgIndex = param.indexOf("msg") + 1
      if (msgIndex != 0)
        msg = param[msgIndex]
    }
    var socket = io();

    var form = document.getElementById('form');
    var input = document.getElementById('txt');

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      if (input.value) {
        socket.emit('broadcast', {
          ev: ev,
          type: 1,
          msg: input.value
        });
        input.value = '';
      }
    });
    socket.emit('joinroom', ev)
    socket.on(ev, function (msg) {

      let payload = msg
      if (payload.type == 1) {
        let txtarea = document.createElement("TEXTAREA");
        txtarea.classList.add("form-control")
        txtarea.value = msg.msg
        document.getElementById('list').appendChild(txtarea)
      }
      else if (payload.type == -1) {
        alert('Failure: More than two users in room!')
      }

    });
    if (msg)
      socket.emit('broadcast', {
          ev: ev,
          type: 1,
          msg: msg
        });

  </script>
</body>

</html>